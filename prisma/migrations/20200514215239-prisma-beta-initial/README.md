# Migration `20200514215239-prisma-beta-initial`

This migration has been generated by Marco Wettstein at 5/14/2020, 9:52:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."Project_thumbnail"

DROP INDEX "public"."SubmissionChallenge_submission"

ALTER TABLE "public"."Challenge" ALTER COLUMN "challenge" DROP DEFAULT,
ALTER COLUMN "context" DROP DEFAULT,
ALTER COLUMN "title" DROP DEFAULT;

ALTER TABLE "public"."HackerSkill" ALTER COLUMN "description" DROP DEFAULT,
ALTER COLUMN "title" DROP DEFAULT;

ALTER TABLE "public"."HackerTopic" ALTER COLUMN "description" DROP DEFAULT,
ALTER COLUMN "title" DROP DEFAULT;

ALTER TABLE "public"."HackerType" ALTER COLUMN "description" DROP DEFAULT,
ALTER COLUMN "title" DROP DEFAULT;

ALTER TABLE "public"."Image" DROP CONSTRAINT IF EXiSTS "Image_project_fkey",
DROP COLUMN "project",
ADD COLUMN "projectId" text   ,
ALTER COLUMN "base64" DROP DEFAULT;

ALTER TABLE "public"."Mentor" ALTER COLUMN "email" DROP DEFAULT,
ALTER COLUMN "languages" DROP DEFAULT,
ALTER COLUMN "linkedin" DROP DEFAULT,
ALTER COLUMN "name" DROP DEFAULT,
ALTER COLUMN "skills" DROP DEFAULT;

ALTER TABLE "public"."Project" ALTER COLUMN "tagline" DROP DEFAULT,
ALTER COLUMN "title" DROP DEFAULT;

ALTER TABLE "public"."Schedule" ALTER COLUMN "data" DROP DEFAULT,
ALTER COLUMN "from" DROP DEFAULT,
ALTER COLUMN "title" DROP DEFAULT,
ALTER COLUMN "to" DROP DEFAULT,
ALTER COLUMN "type" DROP DEFAULT;

ALTER TABLE "public"."Submission" ADD COLUMN "challengeId" text  NOT NULL ,
ALTER COLUMN "additionalTeamMemberCount" DROP DEFAULT,
ALTER COLUMN "createdAt" DROP DEFAULT,
ALTER COLUMN "description" DROP DEFAULT,
ALTER COLUMN "submitterEmail" DROP DEFAULT,
ALTER COLUMN "tagline" DROP DEFAULT,
ALTER COLUMN "teamMembersScreen" DROP DEFAULT,
ALTER COLUMN "title" DROP DEFAULT,
ALTER COLUMN "url" DROP DEFAULT;

ALTER TABLE "public"."SubmissionChallenge" DROP CONSTRAINT IF EXiSTS "SubmissionChallenge_submission_fkey",
DROP COLUMN "submission",
ALTER COLUMN "title" DROP DEFAULT;

ALTER TABLE "public"."SubmissionUser" ALTER COLUMN "email" DROP DEFAULT,
ALTER COLUMN "firstName" DROP DEFAULT,
ALTER COLUMN "lastName" DROP DEFAULT,
ALTER COLUMN "screenName" DROP DEFAULT;

ALTER TABLE "public"."TeamChallengeVote" ALTER COLUMN "score" DROP DEFAULT;

ALTER TABLE "public"."Thumbnail" DROP CONSTRAINT IF EXiSTS "Thumbnail_user_fkey",
DROP COLUMN "user",
ALTER COLUMN "base64" DROP DEFAULT;

ALTER TABLE "public"."User" DROP COLUMN "profilePhotoBase64",
ALTER COLUMN "city" DROP DEFAULT,
ALTER COLUMN "email" DROP DEFAULT,
ALTER COLUMN "emailConfirmed" DROP DEFAULT,
ALTER COLUMN "firstname" DROP DEFAULT,
ALTER COLUMN "lastname" DROP DEFAULT,
ALTER COLUMN "phoneNumber" DROP DEFAULT;

ALTER TABLE "public"."UserLoginToken" ALTER COLUMN "created" SET DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "hashedToken" DROP DEFAULT;

ALTER TABLE "public"."UserResumeToken" ALTER COLUMN "created" SET DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "hashedToken" DROP DEFAULT;

CREATE UNIQUE INDEX "Submission_challengeId" ON "public"."Submission"("challengeId")

ALTER TABLE "public"."Image" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Submission" ADD FOREIGN KEY ("challengeId")REFERENCES "public"."SubmissionChallenge"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER INDEX "public"."TeamChallengeVote.user_challenge_team" RENAME TO "TeamChallengeVote.userId_challengeId_teamId"

ALTER INDEX "public"."User_profilePhoto" RENAME TO "User_profilePhotoId"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200514215239-prisma-beta-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,238 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRESQL_URL")
+}
+
+model Image {
+  id        String   @default(uuid()) @id
+  base64    String
+  user      User
+  Project   Project? @relation(fields: [projectId], references: [id])
+  projectId String?
+}
+
+model Thumbnail {
+  id      String    @default(uuid()) @id
+  base64  String
+  Project Project[]
+}
+
+model Mentor {
+  id        String        @default(uuid()) @id
+  email     String        @unique
+  name      String
+  skills    String
+  linkedin  String
+  languages String
+  topics    HackerTopic[] @relation(references: [id])
+}
+
+model UserResumeToken {
+  id          String   @default(uuid()) @id
+  hashedToken String   @unique
+  created     DateTime @default(now())
+  userId      String
+  user        User     @relation(fields: [userId], references: [id])
+}
+
+model UserLoginToken {
+  id          String   @default(uuid()) @id
+  hashedToken String   @unique
+  created     DateTime @default(now())
+  userId      String
+  user        User     @relation(fields: [userId], references: [id])
+}
+
+model HackerType {
+  id          String @id
+  title       String @unique
+  description String
+  users       User[] @relation(references: [id])
+}
+
+model HackerSkill {
+  id          String @id
+  title       String @unique
+  description String
+  users       User[] @relation(references: [id])
+}
+
+model HackerTopic {
+  id                String      @id
+  title             String      @unique
+  description       String
+  users             User[]      @relation(references: [id])
+  primaryChallenges Challenge[] @relation("primaryTopic")
+  mentors           Mentor[]    @relation(references: [id])
+  teams             Team[]
+  slackId           String?
+}
+
+model UserRole {
+  id    String @id
+  users User[] @relation(references: [id])
+}
+
+model Challenge {
+  id                              String              @default(uuid()) @id
+  title                           String              @unique
+  context                         String
+  challenge                       String
+  solution                        String?
+  resources                       String?
+  commentsByTeam                  String?
+  organization                    String?
+  contactName                     String?
+  contactEmail                    String?
+  teamsThatCanSelectThisChallenge Team[]              @relation("challengesToSelect", references: [id])
+  teamsThatSelectedThisChallenge  Team[]              @relation("challengeSelected")
+  projects                        Project[]
+  primaryTopicId                  String
+  primaryTopic                    HackerTopic         @relation("primaryTopic", fields: [primaryTopicId], references: [id])
+  teamChallengeVotes              TeamChallengeVote[]
+}
+
+model TeamChallengeVote {
+  id          String    @default(uuid()) @id
+  userId      String
+  user        User      @relation(fields: [userId], references: [id])
+  challengeId String
+  challenge   Challenge @relation(fields: [challengeId], references: [id])
+  teamId      String?
+  team        Team?     @relation(fields: [teamId], references: [id])
+  score       Int
+
+  @@unique([userId, challengeId, teamId])
+}
+
+model Team {
+  id                  String              @id
+  challengesToSelect  Challenge[]         @relation("challengesToSelect", references: [id])
+  members             User[]
+  challengeSelectedId String?
+  challengeSelected   Challenge?          @relation("challengeSelected", fields: [challengeSelectedId], references: [id])
+  projects            Project[]
+  slackId             String?
+  challengeVotes      TeamChallengeVote[]
+  primaryTopicId      String?
+  primaryTopic        HackerTopic?        @relation(fields: [primaryTopicId], references: [id])
+  tags                String[]
+}
+
+model User {
+  id                               String              @default(uuid()) @id
+  firstname                        String
+  lastname                         String
+  profilePhotoId                   String?
+  profilePhoto                     Image?              @relation(fields: [profilePhotoId], references: [id])
+  email                            String              @unique
+  emailConfirmed                   Boolean
+  phoneNumber                      String
+  languages                        String[]
+  city                             String
+  hackerTypes                      HackerType[]        @relation(references: [id])
+  hackerSkills                     HackerSkill[]       @relation(references: [id])
+  hackerTopics                     HackerTopic[]       @relation(references: [id])
+  roles                            UserRole[]          @relation(references: [id])
+  loginTokens                      UserLoginToken[]
+  resumeTokens                     UserResumeToken[]
+  possibleTeamMemberEmails         String?
+  participateInTeamBuildingSession Boolean?            @default(false)
+  linkedin                         String?
+  instagram                        String?
+  facebook                         String?
+  twitter                          String?
+  teamId                           String?
+  team                             Team?               @relation(fields: [teamId], references: [id])
+  teamChallengeVotes               TeamChallengeVote[]
+  devpostUrl                       String?
+  isAnonymized                     Boolean             @default(false)
+}
+
+enum ScheduleType {
+  EXTERNAL_LINK
+  INTERNAL_LINK
+}
+
+model Schedule {
+  id    String       @default(uuid()) @id
+  from  DateTime
+  to    DateTime
+  title String
+  type  ScheduleType
+  data  String
+  color String?
+
+  @@unique([from, to])
+}
+
+model Project {
+  id               String     @default(uuid()) @id
+  title            String
+  tagline          String
+  thumbnailId      String?
+  thumbnail        Thumbnail? @relation(fields: [thumbnailId], references: [id])
+  description      String?
+  technologiesUsed String?
+  obstacles        String?
+  accomplishments  String?
+  learnings        String?
+  nextSteps        String?
+  videoUrl         String?
+  urls             String[]
+  images           Image[]
+  challenge        Challenge? @relation(fields: [challengeId], references: [id])
+  challengeId      String?
+  team             Team?      @relation(fields: [teamId], references: [id])
+  teamId           String?
+}
+
+model Submission {
+  id                               String              @default(uuid()) @id
+  title                            String
+  url                              String
+  tagline                          String
+  createdAt                        DateTime
+  description                      String
+  video                            String?
+  website                          String?
+  file                             String?
+  desiredPrizes                    String?
+  builtWith                        String?
+  slackChannel                     String?
+  relevanceForEco                  String?
+  relevanceForChallenge            String?
+  potentialForImpact               String?
+  progressAchieved                 String?
+  projectAddedValue                String?
+  projectContinuation              String?
+  projectPlans                     String?
+  teamMembersScreen                String
+  collegeUniversitiesOfTeamMembers String?
+  additionalTeamMemberCount        Int
+  challengeId                      String
+  challenge                        SubmissionChallenge @relation(fields: [challengeId], references: [id])
+  submitterEmail                   String
+  teamMembers                      SubmissionUser[]    @relation(references: [id])
+}
+
+model SubmissionChallenge {
+  id          String     @default(uuid()) @id
+  title       String
+  description String?
+  topic       String?
+  submission  Submission
+}
+
+model SubmissionUser {
+  id          String       @default(uuid()) @id
+  email       String       @unique
+  firstName   String
+  lastName    String
+  screenName  String
+  submissions Submission[] @relation(references: [id])
+}
```


